<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>任务委托-车捕头</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link rel="stylesheet" type="text/css" href="css/index.css">
</head>

<body>
    <div class="loginForm" style="background: #f3f3f3;">
        <div class="wrapper" style="padding-top: 50px;">
            <div id="file"></div>
        </div>
        <div class="wrapper login-box ">
            <table>
                <tr>
                    <td>
                        <label>车牌号</label>
                    </td>
                    <td>
                        <input type="text" name="carNumber" placeholder="例：浙A88888" />
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input type="button" value="提交" id="login">
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script type="text/javascript" src="js/webuploader.min.js"></script>
    <script type="text/javascript">
      wx.config({
          debug: true,
          appId: 'wx54b6ec4eef54f77b', //secret:49d9994c34fe01967eec42900f706227
          timestamp: '1510730450032',
          nonceStr: '5uw5f1t6h34nl39',
          signature: 'ff5226e725eafddd4d481e84770171803a3dce17',
          jsApiList: ['getLocation']
      });

      wx.ready(() => {
          wx.getLocation({
              type: 'wgs84', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
              success: (res) => {
                  window.latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
                  window.longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
              }
          });

          var uploader;

          // $.ajax({
          //     url: 'http://test.cbt.com:8080/adminServer/qiniu/getToken',
          //     dataType: 'json',
          //     success: function(returnData) {
                  uploader = WebUploader.create({
                      auto: true, //自动上传
                      server: 'http://up.qiniu.com/', //后台server
                      pick: {
                          id: '#file',
                          multiple: false
                      }, //上传按钮id,是否可以多个文件同时上传
                      fileNumLimit: 999, //可上传数量
                      fileSingleSizeLimit: 5242880,
                      duplicate: true, //可重复上传同一张图片
                      fileVal: 'file',
                      formData: {
                          // token: returnData.data.uploadToken
                          token: 'Oa_h69810SW3XaHQAfeVvEEche4lDGQGGNXqRgss:Sr5bENtZhe2ZIktGkVrijj58oWc=:eyJzY29wZSI6ImNoZWJ1dG91IiwiZGVhZGxpbmUiOjE1MTA3NDE1NTR9'
                      }
                  });

                  uploader.on('error', function(type) {
                      alert('上传失败，请重新上传');
                  });

                  uploader.on('uploadAccept', function(file, returnData) {
                      $('.webuploader-pick').css('background', 'url("http://oka19npup.bkt.clouddn.com/' + returnData.key + '") no-repeat');
                      if ($('#carPhoto').length > 0) {
                          $('#carPhoto').remove();
                      }
                      $('<input type="hidden" name="carPhoto" id="carPhoto" value="' + returnData.key + '"/>').insertAfter('#file');
                  });
          //     }
          // });

          $('#login').on('click',function(){
            var carPhoto = $('#carPhoto').val();
            var carNumber = $.trim($('#carNumber').val());
            if(!carPhoto){
              alert('照片未上传');
            }
            if( !carNumber ){
              alert('车牌号未填写');
            }
          });
      });      
    </script>
</body>

</html>